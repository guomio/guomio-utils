const fs = require('fs');
const render = require('json-templater/string');
const path = require('path');
const endOfLine = require('os').EOL;

const base = path.join(__dirname, '../src');
const OUTPUT_PATH = path.join(base, 'index.ts');

const omit = (f) => f !== 'index';

const files = fs
  .readdirSync(base)
  .map((f) => f.replace(/\.ts[x]?$/, ''))
  .filter(omit);

const TEMPLATE = `/* Automatically generated by 'bin/build-index.js' */
{{includes}}

export {
{{lists}}}`;

const IMPORT_TEMPLATE = `
import * as {{name}} from \'./{{package}}\';`;

const includes = [];
const lists = [];

files.forEach((f) => {
  includes.push(
    render(IMPORT_TEMPLATE, {
      name: f,
      package: f,
    }),
  );
  lists.push(` ${f},${endOfLine}`);
});

const template = render(TEMPLATE, {
  includes: includes.join(''),
  lists: lists.join(''),
});

fs.writeFileSync(OUTPUT_PATH, template);
